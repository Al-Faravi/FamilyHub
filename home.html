<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Family Hub | Digital Home</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #4f46e5;
            --secondary: #10b981;
            --accent: #f59e0b;
            --danger: #ef4444;
            --dark: #0f172a;
            --light: #f8fafc;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; scroll-behavior: smooth; }
        body { font-family: 'Poppins', sans-serif; background-color: var(--light); color: var(--dark); overflow-x: hidden; }

        /* Navigation */
        nav {
            padding: 20px 10%;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: transparent;
            position: fixed;
            width: 100%;
            top: 0;
            z-index: 1000;
            transition: 0.4s;
        }
        nav.scrolled {
            background: white;
            padding: 12px 10%;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        .logo { font-size: 1.5rem; font-weight: 700; color: var(--primary); text-decoration: none; }
        .nav-links { list-style: none; display: flex; gap: 30px; align-items: center; }
        .nav-links a { text-decoration: none; color: var(--dark); font-weight: 500; transition: 0.3s; }
        .nav-links a:hover { color: var(--primary); }
        .btn-portal { background: var(--primary); color: white !important; padding: 10px 20px; border-radius: 8px; }

        /* Hero Section */
        .hero {
            height: 85vh;
            background: linear-gradient(135deg, rgba(79, 70, 229, 0.1) 0%, rgba(16, 185, 129, 0.1) 100%);
            display: flex;
            align-items: center;
            padding: 0 10%;
        }
        .hero-content { max-width: 700px; }
        .greeting { color: var(--primary); font-weight: 600; font-size: 1.2rem; margin-bottom: 10px; display: block; }
        .hero-content h1 { font-size: 3.5rem; line-height: 1.2; margin-bottom: 20px; }
        .cta-buttons { display: flex; gap: 15px; flex-wrap: wrap; }
        .btn { padding: 12px 25px; border-radius: 10px; text-decoration: none; font-weight: 600; transition: 0.3s; cursor: pointer; border: none; display: inline-flex; align-items: center; gap: 10px; }
        .btn-main { background: var(--primary); color: white; }
        .btn-fund { background: var(--secondary); color: white; }
        .btn:hover { transform: translateY(-3px); box-shadow: 0 10px 20px rgba(0,0,0,0.1); }

        /* Birthday Highlight Bar */
        .birthday-bar {
            background: var(--accent);
            color: white;
            padding: 12px;
            text-align: center;
            font-weight: 600;
            display: none;
            position: relative;
            z-index: 1001;
        }

        /* Stats Banner */
        .stats-banner {
            margin-top: -60px;
            padding: 0 10%;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }
        .stat-item {
            background: white;
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 10px 25px rgba(0,0,0,0.05);
            border-bottom: 4px solid transparent;
        }
        .stat-item i { font-size: 1.8rem; margin-bottom: 10px; display: block; }
        .stat-item h2 { font-size: 2rem; margin-bottom: 5px; }
        .stat-item p { font-size: 0.85rem; color: #64748b; font-weight: 600; }

        /* Notice Section */
        .section-padding { padding: 80px 10%; }
        .section-header { text-align: center; margin-bottom: 40px; }
        .notice-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; }
        .notice-card { 
            background: white; padding: 25px; border-radius: 15px; 
            border-left: 5px solid var(--primary); box-shadow: 0 5px 15px rgba(0,0,0,0.03);
            transition: 0.3s;
        }
        .notice-card:hover { transform: translateY(-5px); }
        .notice-card.urgent { border-left-color: var(--danger); background: #fffafb; }
        .notice-date { font-size: 0.75rem; color: #94a3b8; display: block; margin-bottom: 10px; }
        .notice-card h3 { margin-bottom: 10px; font-size: 1.1rem; }
        .notice-card p { font-size: 0.9rem; color: #475569; line-height: 1.5; }

        footer { background: var(--dark); color: white; padding: 40px 10%; text-align: center; font-size: 0.9rem; }
        
        @media (max-width: 768px) {
            .hero-content h1 { font-size: 2.2rem; }
            .nav-links { display: none; }
            .hero { padding-top: 100px; height: auto; padding-bottom: 100px; }
        }
    </style>
</head>
<body>

<div id="bday-announcer" class="birthday-bar">
    <i class="fas fa-cake-candles"></i> Today is <span id="bday-name">...</span>'s Birthday! üéÇ
</div>

<nav id="navbar">
    <a href="#" class="logo"><i class="fas fa-house-chimney"></i> FamilyHub</a>
    <ul class="nav-links">
        <li><a href="#notices">Notices</a></li>
        <li><a href="fund.html">Family Fund</a></li>
        <li><a href="index.html" class="btn-portal">Directory</a></li>
    </ul>
</nav>

<section class="hero">
    <div class="hero-content">
        <span class="greeting" id="time-greeting">Hello!</span>
        <h1>Your Family's Digital Home.</h1>
        <p style="margin-bottom: 30px; font-size: 1.1rem; color: #475569;">Manage family members, stay updated with announcements, and track the communal fund‚Äîall in one place.</p>
        <div class="cta-buttons">
            <a href="index.html" class="btn btn-main"><i class="fas fa-users"></i> Member Directory</a>
            <a href="fund.html" class="btn btn-fund"><i class="fas fa-wallet"></i> Family Fund</a>
        </div>
    </div>
</section>

<div class="stats-banner">
    <div class="stat-item" style="border-bottom-color: var(--primary);">
        <i class="fas fa-user-group" style="color: var(--primary);"></i>
        <h2 id="total-members">0</h2>
        <p>TOTAL MEMBERS</p>
    </div>
    <div class="stat-item" style="border-bottom-color: var(--danger);">
        <i class="fas fa-droplet" style="color: var(--danger);"></i>
        <h2 id="blood-donors">0</h2>
        <p>BLOOD DONORS</p>
    </div>
    <div class="stat-item" style="border-bottom-color: var(--secondary);">
        <i class="fas fa-sack-dollar" style="color: var(--secondary);"></i>
        <h2 id="fund-balance">‡ß≥ 0</h2>
        <p>CURRENT FUND</p>
    </div>
</div>

<section id="notices" class="section-padding">
    <div class="section-header">
        <h2><i class="fas fa-bullhorn"></i> Notice Board</h2>
        <p>Important announcements for the family</p>
    </div>
    <div id="notice-container" class="notice-grid">
        <p style="text-align: center; grid-column: 1/-1;">Loading notices...</p>
    </div>
</section>

<footer>
    <p>&copy; 2024 FamilyHub | Organized with ‚ù§Ô∏è for the Family</p>
</footer>

<script>
    const API_BASE = 'http://localhost:5000/api';

    // ‡ßß. ‡¶°‡ßç‡¶Ø‡¶æ‡¶∂‡¶¨‡ßã‡¶∞‡ßç‡¶° ‡¶°‡¶æ‡¶ü‡¶æ ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶æ
    async function loadDashboardData() {
        try {
            // ‡¶Æ‡ßá‡¶Æ‡ßç‡¶¨‡¶æ‡¶∞ ‡¶≤‡¶ø‡¶∏‡ßç‡¶ü ‡¶Ü‡¶®‡¶æ
            const memRes = await fetch(`${API_BASE}/students`);
            const members = await memRes.json();
            
            animateCounter('total-members', members.length);
            const donors = members.filter(m => m.blood_group).length;
            animateCounter('blood-donors', donors);

            // ‡ß®. ‡¶ú‡¶®‡ßç‡¶Æ‡¶¶‡¶ø‡¶® ‡¶ö‡ßá‡¶ï ‡¶ï‡¶∞‡¶æ
            checkBirthdays(members);

            // ‡ß©. ‡¶´‡¶æ‡¶®‡ßç‡¶° ‡¶°‡¶æ‡¶ü‡¶æ ‡¶Ü‡¶®‡¶æ
            const fundRes = await fetch(`${API_BASE}/fund-summary`);
            const fund = await fundRes.json();
            document.getElementById('fund-balance').innerText = `‡ß≥ ${fund.balance}`;

            // ‡ß™. ‡¶®‡ßã‡¶ü‡¶ø‡¶∂ ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶æ
            loadNotices();

        } catch (error) {
            console.error("Dashboard Error:", error);
        }
    }

    // ‡¶ú‡¶®‡ßç‡¶Æ‡¶¶‡¶ø‡¶® ‡¶ö‡ßá‡¶ï ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶≤‡¶ú‡¶ø‡¶ï
    function checkBirthdays(members) {
        const today = new Date();
        const todayStr = `${today.getMonth() + 1}-${today.getDate()}`; 
        
        const bdayBoy = members.find(m => {
            if(!m.dob) return false;
            const d = new Date(m.dob);
            return `${d.getMonth() + 1}-${d.getDate()}` === todayStr;
        });

        if (bdayBoy) {
            document.getElementById('bday-announcer').style.display = 'block';
            document.getElementById('bday-name').innerText = bdayBoy.name;
        }
    }

    // ‡¶®‡ßã‡¶ü‡¶ø‡¶∂ ‡¶∞‡ßá‡¶®‡ßç‡¶°‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶æ (‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶æ‡¶∞ ‡¶•‡ßá‡¶ï‡ßá)
    async function loadNotices() {
        try {
            const res = await fetch(`${API_BASE}/notices`);
            const notices = await res.json();
            const container = document.getElementById('notice-container');

            if(notices.length === 0) {
                container.innerHTML = '<p style="text-align:center; grid-column: 1/-1;">No notices today.</p>';
                return;
            }

            container.innerHTML = notices.map(n => `
                <div class="notice-card ${n.type === 'urgent' ? 'urgent' : ''}">
                    <span class="notice-date">${new Date(n.date).toLocaleDateString()}</span>
                    <h3>${n.title}</h3>
                    <p>${n.content}</p>
                </div>
            `).join('');
        } catch (err) {
            console.error("Notice Error:", err);
        }
    }

    // ‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü‡¶æ‡¶∞ ‡¶è‡¶®‡¶ø‡¶Æ‡ßá‡¶∂‡¶®
    function animateCounter(id, target) {
        let current = 0;
        let increment = Math.ceil(target / 30) || 1;
        let timer = setInterval(() => {
            current += increment;
            if (current >= target) {
                current = target;
                clearInterval(timer);
            }
            document.getElementById(id).innerText = current;
        }, 50);
    }

    // ‡¶∏‡ßç‡¶ï‡ßç‡¶∞‡¶≤ ‡¶á‡¶´‡ßá‡¶ï‡ßç‡¶ü
    window.addEventListener('scroll', () => {
        const nav = document.getElementById('navbar');
        window.scrollY > 50 ? nav.classList.add('scrolled') : nav.classList.remove('scrolled');
    });

    function setGreeting() {
        const hour = new Date().getHours();
        const el = document.getElementById('time-greeting');
        if (hour < 12) el.innerText = "‚òÄÔ∏è Good Morning, Family!";
        else if (hour < 18) el.innerText = "üå§Ô∏è Good Afternoon!";
        else el.innerText = "üåô Good Evening!";
    }

    window.onload = () => {
        setGreeting();
        loadDashboardData();
    };
</script>

</body>
</html>